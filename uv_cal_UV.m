function [CX,H,ug,vg,Pt]=uv_cal_UV(rx,ry,sc,C,U,V,Rend,A,T,lat,rho0)
a=rx;b=ry;c=2;pz=2000;D=1;
t=linspace(0,T,200)*24*60*60;
Rt=(1/40*(0:200).*((0:200)<=40)+1.*((0:200)>40&(0:200)<=160) ...
    +(-1/40)*((0:200)-200).*(0:200>160))*Rend;
At=(1/40*(0:200).*((0:200)<=40)+1.*((0:200)>40&(0:200)<=160) ...
    +(-1/40)*((0:200)-200).*(0:200>160))*A;
xx=linspace(-sc,sc,a).*Rend;dx=xx(2)-xx(1);
yy=linspace(-sc,sc,b).*Rend;dy=yy(2)-yy(1);
zz=linspace(0,-pz,c);dz=zz(2)-zz(1);
s=0;
[x3,y3,z3]=meshgrid(xx,yy,zz);
f=sw_f(lat);g=9.8;rho0s=rho0;
%CX=(1.56+(-0.56/40*(1:200))).*(1:200<=40)*mv+1.*((1:200)>40&(1:200)<=160)*mv+ ...
%    (1+(0.56/40)*((1:200)-160))*mv.*((1:200)>160);
CX=C.*ones(1,201);
%Rt=Rend*ones(1,201);
%At=A*ones(1,201);
X1=CX(1)*t(40)+1/2.*((CX(2)-CX(1))/(t(2)-t(1)))*t(40).^2;
X2=X1+CX(160).*(t(160)-t(40));
a1=(CX(2)-CX(1))/(t(2)-t(1));
a3=-a1;
for i=1:200
if i==1
    P=zeros(a,b,2);
else
    P=At(i)*(1-(((x3+CX(1)*t(i)+(1/2.*a1.*t(i).^2))./Rt(i)).^2 ...
+(y3./Rt(i)).^2)./2).*exp(-(((x3+CX(1)*t(i)+(1/2.*a1.*t(i).^2))./Rt(i)).^2+...
(y3./Rt(i)).^2)./2).*(sin((pi/4000).*z3)+D)*rho0s.*g*(t(i)<=t(40))+...
At(i)*(1-(((x3+(X1+CX(i).*(t(i)-t(40))))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*exp(-(((x3+(X1+CX(i).*(t(i)-t(40))))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*...
rho0s.*g.*(sin((pi/4000).*z3)+D)*(t(40)<t(i)&t(i)<=t(160))+...
At(i)*(1-(((x3+(X2+CX(160)*(t(i)-t(160))+1/2.*a3*(t(i)-t(160)).^2))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*...
exp(-(((x3+(X2+CX(160)*(t(i)-t(160))+1/2.*a3*(t(i)-t(160)).^2))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*...
rho0s.*g.*(sin((pi/4000).*z3)+D)*(t(i)>t(160));
end
%%
%P=At(i)*(1-(((x3+CX(1)*t(i)+(1/2.*a1.*t(i).^2))./Rt(i)).^2 ...
%+(y3./Rt(i)).^2)./2).*exp(-(((x3+CX(1)*t(i)+(1/2.*a1.*t(i).^2))./Rt(i)).^2+...
%(y3./Rt(i)).^2)./2).*(sin((pi/4000).*z3)+D)*rho0s.*g*(t(i)<=t(40))+...
%At(i)*(1-(((x3+(X1+CX(i).*(t(i)-t(40))))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*exp(-(((x3+(X1+CX(i).*(t(i)-t(40))))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*...
%rho0s.*g.*(sin((pi/4000).*z3)+D)*(t(40)<t(i)&t(i)<=t(160))+...
%At(i)*(1-(((x3+(X2+CX(160)*(t(i)-t(160))+1/2.*a3*(t(i)-t(160)).^2))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*...
%exp(-(((x3+(X2+CX(160)*(t(i)-t(160))+1/2.*a3*(t(i)-t(160)).^2))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*...
%rho0s.*g.*(sin((pi/4000).*z3)+D)*(t(i)>t(160));
%%
%if i==1
%    P=zeros(a,b,2);
%else
%P=At(i)*(1-(((x3+CX(1)*t(i)+(1/2.*a1.*t(i).^2))./Rt(i)).^2 ...
%+(y3./Rt(i)).^2)./2).*exp(-(((x3+CX(1)*t(i)+(1/2.*a1.*t(i).^2))./Rt(i)).^2+...
%(y3./Rt(i)).^2)./2).*(sin((pi/4000).*z3)+D)*rho0s.*g*(t(i)<=t(40))+...
%At(i)*(1-(((x3+(X1+CX(i).*(t(i)-t(40))))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*exp(-(((x3+(X1+CX(i).*(t(i)-t(40))))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*...
%rho0s.*g.*(sin((pi/4000).*z3)+D)*(t(40)<t(i)&t(i)<=t(160))+...
%At(i)*(1-(((x3+(X2+CX(160)*(t(i)-t(160))+1/2.*a3*(t(i)-t(160)).^2))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*...
%exp(-(((x3+(X2+CX(160)*(t(i)-t(160))+1/2.*a3*(t(i)-t(160)).^2))./Rt(i)).^2+(y3./Rt(i)).^2)./2).*...
%rho0s.*g.*(sin((pi/4000).*z3)+D)*(t(i)>t(160));
%end

%Pg=P-rho0*g.*z3;
H(:,:,i)=P(1:end-1,1:end-1,1)./(rho0*g);
%dpdz=(Pg(:,:,2:end)-Pg(:,:,1:end-1))./dz;
%rhog=-dpdz./g;
%ug(:,:,i)=-1./f./rhog(1:end-1,1:end-1,1:end).*((P(2:end,1:end-1,1:end-1)-P(1:end-1,1:end-1,1:end-1)))/dy+U;
%vg(:,:,i)=1./f./rhog(1:end-1,1:end-1,1:end).*((P(1:end-1,2:end,1:end-1)-P(1:end-1,1:end-1,1:end-1)))/dx;
%disp(num2str(i));
ug(:,:,i)=-1./f./rho0.*((P(2:end,1:end-1,1:end-1)-P(1:end-1,1:end-1,1:end-1)))/dy+U;
vg(:,:,i)=1./f./rho0.*((P(1:end-1,2:end,1:end-1)-P(1:end-1,1:end-1,1:end-1)))/dx+V;
Pt(:,:,:,i)=P;
end

%ug(:,:,1)=zeros(a-1,b-1);vg(:,:,1)=zeros(a-1,b-1);
end

%%



